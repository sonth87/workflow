{
  "name": "Customer Onboarding",
  "description": "Dynamic workflow driven entirely by node configs",
  "status": "draft",
  "version": "1.0.0",
  "metadata": {
    "owner": "ops-team",
    "category": "onboarding",
    "tags": ["customer", "kyc"]
  },
  "nodes": [
    {
      "id": "start-1",
      "nodeType": "startEventDefault",
      "category_type": "start",
      "label": "Webhook Trigger",
      "position": { "x": 100, "y": 80 },
      "data": {
        "form_configs": {
          "fields": [
            {
              "_id": "f-trigger-url",
              "type": "input",
              "field_type": "text",
              "label": { "en": "Webhook URL" },
              "field_code": "webhook_url",
              "editable": true,
              "visible": true,
              "order": 1,
              "placeholder": { "en": "https://example.com/hook" }
            }
          ]
        }
      }
    },
    {
      "id": "task-collect",
      "nodeType": "taskDefault",
      "category_type": "task",
      "label": "Collect Profile",
      "position": { "x": 320, "y": 80 },
      "data": {
        "role": "Agent",
        "form_configs": {
          "fields": [
            {
              "_id": "f-full-name",
              "type": "input",
              "field_type": "text",
              "label": { "en": "Full Name", "vi": "Họ và tên" },
              "field_code": "full_name",
              "editable": true,
              "visible": true,
              "order": 1,
              "placeholder": { "en": "John Doe" }
            },
            {
              "_id": "f-country",
              "type": "input",
              "field_type": "option",
              "label": { "en": "Country" },
              "field_code": "country",
              "editable": true,
              "visible": true,
              "order": 2,
              "value_option": [
                { "value": "US", "label": { "en": "United States" } },
                { "value": "VN", "label": { "en": "Vietnam", "vi": "Việt Nam" } },
                { "value": "SG", "label": { "en": "Singapore" } }
              ]
            },
            {
              "_id": "f-income",
              "type": "input",
              "field_type": "number",
              "label": { "en": "Annual Income" },
              "field_code": "income",
              "editable": true,
              "visible": true,
              "order": 3,
              "format": "currency"
            }
          ]
        }
      }
    },
    {
      "id": "service-risk",
      "nodeType": "serviceTask",
      "category_type": "task",
      "label": "Risk Scoring",
      "position": { "x": 560, "y": 80 },
      "data": {
        "api": {
          "url": "https://risk.internal/api/score",
          "method": "POST",
          "params": { "source": "onboarding" },
          "body": { "customer_id": "{{context.customerId}}" },
          "success_transform": "return response.score;",
          "error_transform": "return { error: err.message };"
        },
        "form_configs": {
          "fields": [
            {
              "_id": "f-risk-threshold",
              "type": "input",
              "field_type": "number",
              "label": { "en": "Risk Threshold" },
              "field_code": "risk_threshold",
              "editable": true,
              "visible": true,
              "order": 1,
              "value": 70
            }
          ]
        }
      }
    },
    {
      "id": "notify-approved",
      "nodeType": "notification",
      "category_type": "task",
      "label": "Notify Customer",
      "position": { "x": 780, "y": 80 },
      "data": {
        "channel": "email",
        "template": "approval-template",
        "form_configs": {
          "fields": [
            {
              "_id": "f-template",
              "type": "input",
              "field_type": "option",
              "label": { "en": "Template" },
              "field_code": "template_id",
              "editable": true,
              "visible": true,
              "order": 1,
              "options_url": {
                "url": "https://content.internal/api/templates",
                "method": "GET",
                "transform": "return response.items;",
                "option_value": "id",
                "option_label": "title"
              }
            }
          ]
        }
      }
    },
    {
      "id": "end-1",
      "nodeType": "endEventDefault",
      "category_type": "end",
      "label": "Completion",
      "position": { "x": 980, "y": 80 },
      "data": {}
    }
  ],
  "validationRules": {
    "startEventDefault": {
      "maxInputConnections": 0,
      "maxOutputConnections": 1
    },
    "endEventDefault": { "maxOutputConnections": 0 }
  }
}
