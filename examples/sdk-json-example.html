<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BPM Core SDK - JSON Configuration Example</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
      }
      #bpm-container {
        width: 100vw;
        height: 100vh;
      }
      .info-panel {
        position: fixed;
        bottom: 10px;
        left: 10px;
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        max-width: 300px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        z-index: 1000;
      }
      .info-panel h3 {
        margin: 0 0 10px 0;
        font-size: 14px;
      }
      .info-panel p {
        margin: 5px 0;
        font-size: 12px;
        color: #666;
      }
      .event-log {
        margin-top: 10px;
        padding: 10px;
        background: #f5f5f5;
        border-radius: 4px;
        max-height: 200px;
        overflow-y: auto;
        font-size: 11px;
        font-family: monospace;
      }
      .event-log div {
        margin: 2px 0;
        padding: 2px 0;
        border-bottom: 1px solid #ddd;
      }
      .info-panel.minimized #panel-content {
        display: none;
      }
      .info-panel.minimized h3 {
        margin-bottom: 0;
        font-size: 14px;
      }
      .info-panel.minimized {
        bottom: 0px;
        left: 0px;
        padding: 2px 8px;
      }
      #minimize-btn {
        background: none;
        border: none;
        cursor: pointer;
        font-size: 24px;
        line-height: 24px;
        float: right;
        color: #666;
        font-weight: bold;
      }
      #language-select {
        position: fixed;
        top: 10px;
        right: 10px;
        z-index: 1001;
        padding: 8px 12px;
        border-radius: 4px;
        border: 1px solid #ddd;
        background: white;
        cursor: pointer;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <div id="bpm-container"></div>

    <div class="info-panel">
      <h3>JSON Configuration Active <button id="minimize-btn">-</button></h3>
      <div id="panel-content">
        <p>Custom nodes loaded from JSON:</p>
        <ul
          id="loaded-nodes"
          style="font-size: 11px; margin: 5px 0; padding-left: 20px"
        ></ul>
        <div class="event-log" id="event-log">
          <strong>Event Log:</strong>
        </div>
      </div>
    </div>

    <select id="language-select">
      <option value="en">English</option>
      <option value="vi">Tiếng Việt</option>
      <option value="ko">한국어 (Korean)</option>
    </select>

    <!-- Load BPM SDK -->
    <script src="../sdk-dist/bpm-sdk.js"></script>

    <script>
      // UI Translations with Korean support
      const uiTranslations = {
        toolbar: {
          selectTool: {
            en: "Select tool (V)",
            vi: "Công cụ chọn (V)",
            ko: "선택 도구 (V)",
          },
          handTool: {
            en: "Hand tool (H) - Pan canvas only",
            vi: "Công cụ cầm nắm (H)",
            ko: "손 도구 (H) - 캔버스만 이동",
          },
          zoomOut: { en: "Zoom out", vi: "Thu nhỏ", ko: "축소" },
          zoomIn: { en: "Zoom in", vi: "Phóng to", ko: "확대" },
          resetView: {
            en: "Reset view",
            vi: "Đặt lại chế độ xem",
            ko: "보기 재설정",
          },
          fullscreen: {
            en: "Fullscreen",
            vi: "Toàn màn hình",
            ko: "전체 화면",
          },
          moreOptions: {
            en: "More options",
            vi: "Thêm tùy chọn",
            ko: "더 많은 옵션",
          },
          options: { en: "Options", vi: "Tùy chọn", ko: "옵션" },
          minimap: { en: "Minimap", vi: "Bản đồ thu nhỏ", ko: "미니맵" },
        },
        toolbox: {
          toolbox: { en: "Toolbox", vi: "Hộp công cụ", ko: "도구 상자" },
          expandToolbox: {
            en: "Expand toolbox",
            vi: "Mở rộng hộp công cụ",
            ko: "도구 상자 확장",
          },
          minimizeToolbox: {
            en: "Minimize toolbox",
            vi: "Thu nhỏ hộp công cụ",
            ko: "도구 상자 최소화",
          },
          collapseToolbox: {
            en: "Collapse toolbox",
            vi: "Đóng hộp công cụ",
            ko: "도구 상자 축소",
          },
        },
        properties: {
          nodeProperties: {
            en: "Node Properties",
            vi: "Thuộc tính nút",
            ko: "노드 속성",
          },
          edgeProperties: {
            en: "Edge Properties",
            vi: "Thuộc tính cạnh",
            ko: "엣지 속성",
          },
        },
        contextMenu: {
          resetColor: {
            en: "Reset Color",
            vi: "Đặt lại màu",
            ko: "색상 재설정",
          },
          changeColor: { en: "Change Color", vi: "Đổi màu", ko: "색상 변경" },
          delete: { en: "Delete", vi: "Xóa", ko: "삭제" },
          properties: { en: "Properties", vi: "Thuộc tính", ko: "속성" },
        },
      };

      // Define custom nodes as JSON
      const customNodes = [
        {
          id: "sendEmailTask",
          extends: "task",
          name: { en: "Send Email", vi: "Gửi Email", ko: "이메일 전송" },
          description: {
            en: "Send email notification",
            vi: "Gửi thông báo email",
            ko: "이메일 알림 발송",
          },
          icon: {
            type: "lucide",
            value: "Mail",
            color: "#ffffff",
            backgroundColor: "#e74c3c",
          },
          visualConfig: {
            backgroundColor: "#fef2f2",
            borderColor: "#ef4444",
            textColor: "#7f1d1d",
          },
          properties: [
            {
              id: "to",
              name: "to",
              label: { en: "To", vi: "Gửi tới", ko: "받는 사람" },
              type: "text",
              required: true,
              placeholder: "email@example.com",
              group: "custom",
              order: 1,
            },
            {
              id: "subject",
              name: "subject",
              label: { en: "Subject", vi: "Chủ đề", ko: "제목" },
              type: "text",
              required: true,
              group: "custom",
              order: 2,
            },
            {
              id: "body",
              name: "body",
              label: { en: "Body", vi: "Nội dung", ko: "본문" },
              type: "textarea",
              required: true,
              group: "custom",
              order: 3,
            },
          ],
          contextMenuItems: [
            {
              id: "test-email",
              label: {
                en: "Send Test Email",
                vi: "Gửi Email Test",
                ko: "테스트 이메일 전송",
              },
              icon: "Send",
              action: {
                type: "event",
                event: "custom:send-test-email",
              },
            },
          ],
          eventTriggers: [
            {
              on: "node:added",
              action: "emit",
              event: "custom:email-node-created",
              payload: { type: "email" },
            },
          ],
          hooks: {
            onCreated: "custom:sendEmailTask:created",
          },
        },
        {
          id: "httpRequestTask",
          extends: "task",
          name: { en: "HTTP Request", vi: "Yêu cầu HTTP", ko: "HTTP 요청" },
          description: {
            en: "Make HTTP/REST API calls",
            vi: "Thực hiện gọi HTTP/REST API",
            ko: "HTTP/REST API 호출 수행",
          },
          icon: {
            type: "lucide",
            value: "Globe",
            color: "#ffffff",
            backgroundColor: "#3b82f6",
          },
          properties: [
            {
              id: "url",
              name: "url",
              label: { en: "URL", vi: "URL", ko: "URL" },
              type: "text",
              required: true,
              placeholder: "https://api.example.com",
              group: "custom",
              order: 1,
            },
            {
              id: "method",
              name: "method",
              label: { en: "Method", vi: "Phương thức", ko: "메서드" },
              type: "select",
              required: true,
              defaultValue: "GET",
              group: "custom",
              order: 2,
              options: [
                { label: "GET", value: "GET" },
                { label: "POST", value: "POST" },
                { label: "PUT", value: "PUT" },
                { label: "DELETE", value: "DELETE" },
              ],
            },
          ],
          contextMenuItems: [
            {
              id: "test-request",
              label: {
                en: "Test Request",
                vi: "Kiểm tra Yêu cầu",
                ko: "요청 테스트",
              },
              icon: "Play",
              action: {
                type: "event",
                event: "custom:test-http-request",
              },
            },
          ],
        },
        {
          id: "conditionalStart",
          extends: "start",
          name: {
            en: "Conditional Start",
            vi: "Bắt đầu Điều kiện",
            ko: "조건부 시작",
          },
          description: {
            en: "Start with condition",
            vi: "Bắt đầu với điều kiện",
            ko: "조건으로 시작",
          },
          icon: {
            type: "lucide",
            value: "AlarmClock",
          },
          properties: [
            {
              id: "condition",
              name: "condition",
              label: { en: "Condition", vi: "Điều kiện", ko: "조건" },
              type: "text",
              required: true,
              placeholder: "variable === 'value'",
              group: "custom",
            },
          ],
        },
        {
          id: "simpleTask",
          extends: "task",
          name: { en: "Simple Task", vi: "Nhiệm vụ Đơn giản", ko: "단순 작업" },
          description: {
            en: "Task with minimal context menu",
            vi: "Nhiệm vụ với menu ngữ cảnh tối thiểu",
            ko: "최소 컨텍스트 메뉴가 있는 작업",
          },
          icon: {
            type: "lucide",
            value: "CheckSquare",
            color: "#ffffff",
            backgroundColor: "#10b981",
          },
          visualConfig: {
            backgroundColor: "#ecfdf5",
            borderColor: "#10b981",
            textColor: "#064e3b",
          },
          // Disable some default context menu items
          disableDefaultContextMenu: ["change-type", "appearance"],
          contextMenuItems: [
            {
              id: "mark-complete",
              label: {
                en: "Mark Complete",
                vi: "Đánh dấu Hoàn thành",
                ko: "완료로 표시",
              },
              icon: "Check",
              action: {
                type: "event",
                event: "custom:task-complete",
              },
            },
          ],
        },
        {
          id: "lockedTask",
          extends: "task",
          name: { en: "Locked Task", vi: "Nhiệm vụ Khóa", ko: "잠긴 작업" },
          description: {
            en: "Task with no duplicate/delete",
            vi: "Nhiệm vụ không sao chép/xóa",
            ko: "복제/삭제 없는 작업",
          },
          icon: {
            type: "lucide",
            value: "Lock",
            color: "#ffffff",
            backgroundColor: "#f59e0b",
          },
          visualConfig: {
            backgroundColor: "#fef3c7",
            borderColor: "#f59e0b",
            textColor: "#78350f",
          },
          // Disable duplicate and delete options
          disableDefaultContextMenu: ["duplicate", "delete"],
          contextMenuItems: [
            {
              id: "unlock",
              label: {
                en: "Unlock Task",
                vi: "Mở Khóa Nhiệm vụ",
                ko: "작업 잠금 해제",
              },
              icon: "Unlock",
              action: {
                type: "event",
                event: "custom:unlock-task",
              },
            },
          ],
        },
        {
          id: "minimalTask",
          extends: "task",
          name: {
            en: "Minimal Task",
            vi: "Nhiệm vụ Tối thiểu",
            ko: "최소 작업",
          },
          description: {
            en: "Task with only custom menu",
            vi: "Nhiệm vụ chỉ với menu tùy chỉnh",
            ko: "맞춤 메뉴만 있는 작업",
          },
          icon: {
            type: "lucide",
            value: "Minimize",
            color: "#ffffff",
            backgroundColor: "#6366f1",
          },
          visualConfig: {
            backgroundColor: "#eef2ff",
            borderColor: "#6366f1",
            textColor: "#312e81",
          },
          // Disable all default context menu items
          disableDefaultContextMenu: ["all"],
          contextMenuItems: [
            {
              id: "execute",
              label: {
                en: "Execute Task",
                vi: "Thực thi Nhiệm vụ",
                ko: "작업 실행",
              },
              icon: "Play",
              action: {
                type: "event",
                event: "custom:execute-task",
              },
            },
            {
              id: "configure",
              label: { en: "Configure", vi: "Cấu hình", ko: "구성" },
              icon: "Settings",
              action: {
                type: "event",
                event: "custom:configure-task",
              },
            },
          ],
        },
      ];

      // Initialize BPM with JSON config
      var bpm = new BPM({
        selector: "#bpm-container",
        options: {
          // Load custom nodes from JSON
          customNodes: customNodes,
          // Pass custom translations with Korean support
          uiTranslations: uiTranslations,
          // Set default language
          defaultLanguage: "en",

          ui: {
            mode: "edit",
            showHeader: true,
            showToolbox: true,
            showPropertiesPanel: true,
          },
        },

        onReady: function (instance) {
          console.log(
            "BPM Core initialized with JSON config and Korean language support"
          );

          // Get current language and set it in the select
          const currentLanguage = bpm.getLanguage();
          console.log("Current language:", currentLanguage);
          const languageSwitcher = document.getElementById("language-select");
          languageSwitcher.value = currentLanguage;

          // Handle language change
          languageSwitcher.addEventListener("change", function (e) {
            console.log("Language changed to:", e.target.value);
            bpm.setLanguage(e.target.value);
            console.log("Language updated successfully!");
          });

          // Update UI with loaded nodes
          const nodesList = document.getElementById("loaded-nodes");
          customNodes.forEach(function (node) {
            const li = document.createElement("li");
            const nodeName = node.name.en || node.name; // Handle both string and multilingual names
            li.textContent = nodeName + " (" + node.id + ")";
            nodesList.appendChild(li);
          });

          // Subscribe to custom events
          bpm.on("custom:email-node-created", function (event) {
            logEvent("Email node created", event.payload);
          });

          bpm.on("custom:sendEmailTask:created", function (event) {
            logEvent("sendEmailTask hook triggered", event.payload);
          });

          bpm.on("custom:send-test-email", function (event) {
            logEvent("Test email triggered", event.payload);
            alert("Test email would be sent!");
          });

          bpm.on("custom:test-http-request", function (event) {
            logEvent("Test HTTP request triggered", event.payload);
            alert("Test HTTP request would be executed!");
          });

          bpm.on("node:added", function (event) {
            logEvent("Node added to workflow", {
              type: event.payload.node?.type,
            });
          });

          // Additional custom events for new nodes
          bpm.on("custom:task-complete", function (event) {
            logEvent("Task marked complete", event.payload);
            alert("Task completed!");
          });

          bpm.on("custom:unlock-task", function (event) {
            logEvent("Task unlocked", event.payload);
            alert("Task unlocked!");
          });

          bpm.on("custom:execute-task", function (event) {
            logEvent("Execute task", event.payload);
            alert("Task executed!");
          });

          bpm.on("custom:configure-task", function (event) {
            logEvent("Configure task", event.payload);
            alert("Opening configuration...");
          });
        },

        onError: function (error) {
          console.error("BPM initialization error:", error);
          alert("Error: " + error.message);
        },
      });

      // Minimize button functionality
      document
        .getElementById("minimize-btn")
        .addEventListener("click", function () {
          const panel = document.querySelector(".info-panel");
          panel.classList.toggle("minimized");
          this.textContent = panel.classList.contains("minimized") ? "" : "-";
        });

      // Expand panel when clicking on minimized panel (excluding button)
      document
        .querySelector(".info-panel")
        .addEventListener("click", function (event) {
          if (
            event.target.id !== "minimize-btn" &&
            this.classList.contains("minimized")
          ) {
            this.classList.remove("minimized");
            document.getElementById("minimize-btn").textContent = "-";
          }
        });

      // Helper function to log events
      function logEvent(message, data) {
        const logDiv = document.getElementById("event-log");
        const entry = document.createElement("div");
        const time = new Date().toLocaleTimeString();
        entry.textContent = time + " - " + message;
        if (data) {
          entry.textContent += " | " + JSON.stringify(data);
        }
        logDiv.appendChild(entry);
        logDiv.scrollTop = logDiv.scrollHeight;
      }
    </script>
  </body>
</html>
