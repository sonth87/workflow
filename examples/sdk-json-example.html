<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BPM Core SDK - JSON Configuration Example</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu,
          Cantarell, sans-serif;
      }
      #bpm-container {
        width: 100vw;
        height: 100vh;
      }
      .info-panel {
        position: fixed;
        bottom: 10px;
        left: 10px;
        background: white;
        border: 1px solid #ddd;
        border-radius: 8px;
        padding: 15px;
        max-width: 300px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        z-index: 1000;
      }
      .info-panel h3 {
        margin: 0 0 10px 0;
        font-size: 14px;
      }
      .info-panel p {
        margin: 5px 0;
        font-size: 12px;
        color: #666;
      }
      .event-log {
        margin-top: 10px;
        padding: 10px;
        background: #f5f5f5;
        border-radius: 4px;
        max-height: 200px;
        overflow-y: auto;
        font-size: 11px;
        font-family: monospace;
      }
      .event-log div {
        margin: 2px 0;
        padding: 2px 0;
        border-bottom: 1px solid #ddd;
      }
    </style>
  </head>
  <body>
    <div id="bpm-container"></div>

    <div class="info-panel">
      <h3>JSON Configuration Active</h3>
      <p>Custom nodes loaded from JSON:</p>
      <ul
        id="loaded-nodes"
        style="font-size: 11px; margin: 5px 0; padding-left: 20px"
      ></ul>
      <div class="event-log" id="event-log">
        <strong>Event Log:</strong>
      </div>
    </div>

    <!-- Load BPM SDK -->
    <script src="../sdk-dist/bpm-sdk.js"></script>

    <script>
      // Define custom nodes as JSON
      const customNodes = [
        {
          id: "sendEmailTask",
          extends: "task",
          name: "Send Email",
          description: "Send email notification",
          icon: {
            type: "lucide",
            value: "Mail",
            color: "#ffffff",
            backgroundColor: "#e74c3c",
          },
          visualConfig: {
            backgroundColor: "#fef2f2",
            borderColor: "#ef4444",
            textColor: "#7f1d1d",
          },
          properties: [
            {
              id: "to",
              name: "to",
              label: "To",
              type: "text",
              required: true,
              placeholder: "email@example.com",
              group: "custom",
              order: 1,
            },
            {
              id: "subject",
              name: "subject",
              label: "Subject",
              type: "text",
              required: true,
              group: "custom",
              order: 2,
            },
            {
              id: "body",
              name: "body",
              label: "Body",
              type: "textarea",
              required: true,
              group: "custom",
              order: 3,
            },
          ],
          contextMenuItems: [
            {
              id: "test-email",
              label: "Send Test Email",
              icon: "Send",
              action: {
                type: "event",
                event: "custom:send-test-email",
              },
            },
          ],
          eventTriggers: [
            {
              on: "node:added",
              action: "emit",
              event: "custom:email-node-created",
              payload: { type: "email" },
            },
          ],
          hooks: {
            onCreated: "custom:sendEmailTask:created",
          },
        },
        {
          id: "httpRequestTask",
          extends: "task",
          name: "HTTP Request",
          description: "Make HTTP/REST API calls",
          icon: {
            type: "lucide",
            value: "Globe",
            color: "#ffffff",
            backgroundColor: "#3b82f6",
          },
          properties: [
            {
              id: "url",
              name: "url",
              label: "URL",
              type: "text",
              required: true,
              placeholder: "https://api.example.com",
              group: "custom",
              order: 1,
            },
            {
              id: "method",
              name: "method",
              label: "Method",
              type: "select",
              required: true,
              defaultValue: "GET",
              group: "custom",
              order: 2,
              options: [
                { label: "GET", value: "GET" },
                { label: "POST", value: "POST" },
                { label: "PUT", value: "PUT" },
                { label: "DELETE", value: "DELETE" },
              ],
            },
          ],
          contextMenuItems: [
            {
              id: "test-request",
              label: "Test Request",
              icon: "Play",
              action: {
                type: "event",
                event: "custom:test-http-request",
              },
            },
          ],
        },
        {
          id: "conditionalStart",
          extends: "start",
          name: "Conditional Start",
          description: "Start with condition",
          icon: {
            type: "lucide",
            value: "AlarmClock",
          },
          properties: [
            {
              id: "condition",
              name: "condition",
              label: "Condition",
              type: "text",
              required: true,
              placeholder: "variable === 'value'",
              group: "custom",
            },
          ],
        },
        {
          id: "simpleTask",
          extends: "task",
          name: "Simple Task",
          description: "Task with minimal context menu",
          icon: {
            type: "lucide",
            value: "CheckSquare",
            color: "#ffffff",
            backgroundColor: "#10b981",
          },
          visualConfig: {
            backgroundColor: "#ecfdf5",
            borderColor: "#10b981",
            textColor: "#064e3b",
          },
          // Disable some default context menu items
          disableDefaultContextMenu: ["change-type", "appearance"],
          contextMenuItems: [
            {
              id: "mark-complete",
              label: "Mark Complete",
              icon: "Check",
              action: {
                type: "event",
                event: "custom:task-complete",
              },
            },
          ],
        },
        {
          id: "lockedTask",
          extends: "task",
          name: "Locked Task",
          description: "Task with no duplicate/delete",
          icon: {
            type: "lucide",
            value: "Lock",
            color: "#ffffff",
            backgroundColor: "#f59e0b",
          },
          visualConfig: {
            backgroundColor: "#fef3c7",
            borderColor: "#f59e0b",
            textColor: "#78350f",
          },
          // Disable duplicate and delete options
          disableDefaultContextMenu: ["duplicate", "delete"],
          contextMenuItems: [
            {
              id: "unlock",
              label: "Unlock Task",
              icon: "Unlock",
              action: {
                type: "event",
                event: "custom:unlock-task",
              },
            },
          ],
        },
        {
          id: "minimalTask",
          extends: "task",
          name: "Minimal Task",
          description: "Task with only custom menu",
          icon: {
            type: "lucide",
            value: "Minimize",
            color: "#ffffff",
            backgroundColor: "#6366f1",
          },
          visualConfig: {
            backgroundColor: "#eef2ff",
            borderColor: "#6366f1",
            textColor: "#312e81",
          },
          // Disable all default context menu items
          disableDefaultContextMenu: ["all"],
          contextMenuItems: [
            {
              id: "execute",
              label: "Execute Task",
              icon: "Play",
              action: {
                type: "event",
                event: "custom:execute-task",
              },
            },
            {
              id: "configure",
              label: "Configure",
              icon: "Settings",
              action: {
                type: "event",
                event: "custom:configure-task",
              },
            },
          ],
        },
      ];

      // Initialize BPM with JSON config
      var bpm = new BPM({
        selector: "#bpm-container",
        options: {
          // Load custom nodes from JSON
          customNodes: customNodes,

          ui: {
            mode: "edit",
            showHeader: true,
            showToolbox: true,
            showPropertiesPanel: true,
          },
        },

        onReady: function (instance) {
          console.log("BPM Core initialized with JSON config");

          // Update UI with loaded nodes
          const nodesList = document.getElementById("loaded-nodes");
          customNodes.forEach(function (node) {
            const li = document.createElement("li");
            li.textContent = node.name + " (" + node.id + ")";
            nodesList.appendChild(li);
          });

          // Subscribe to custom events
          bpm.on("custom:email-node-created", function (event) {
            logEvent("Email node created", event.payload);
          });

          bpm.on("custom:sendEmailTask:created", function (event) {
            logEvent("sendEmailTask hook triggered", event.payload);
          });

          bpm.on("custom:send-test-email", function (event) {
            logEvent("Test email triggered", event.payload);
            alert("Test email would be sent!");
          });

          bpm.on("custom:test-http-request", function (event) {
            logEvent("Test HTTP request triggered", event.payload);
            alert("Test HTTP request would be executed!");
          });

          bpm.on("node:added", function (event) {
            logEvent("Node added to workflow", {
              type: event.payload.node?.type,
            });
          });

          // Additional custom events for new nodes
          bpm.on("custom:task-complete", function (event) {
            logEvent("Task marked complete", event.payload);
            alert("Task completed!");
          });

          bpm.on("custom:unlock-task", function (event) {
            logEvent("Task unlocked", event.payload);
            alert("Task unlocked!");
          });

          bpm.on("custom:execute-task", function (event) {
            logEvent("Execute task", event.payload);
            alert("Task executed!");
          });

          bpm.on("custom:configure-task", function (event) {
            logEvent("Configure task", event.payload);
            alert("Opening configuration...");
          });
        },

        onError: function (error) {
          console.error("BPM initialization error:", error);
          alert("Error: " + error.message);
        },
      });

      // Helper function to log events
      function logEvent(message, data) {
        const logDiv = document.getElementById("event-log");
        const entry = document.createElement("div");
        const time = new Date().toLocaleTimeString();
        entry.textContent = time + " - " + message;
        if (data) {
          entry.textContent += " | " + JSON.stringify(data);
        }
        logDiv.appendChild(entry);
        logDiv.scrollTop = logDiv.scrollHeight;
      }
    </script>
  </body>
</html>
